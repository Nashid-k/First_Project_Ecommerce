    <%-include('../layouts/header')  %>
    

        <!-- Breadcrumb Begin -->
        <div class="breadcrumb-option">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="breadcrumb__links">
                            <a href="/"><i class="fa fa-home"></i> Home</a>
                            <span>Shop</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Breadcrumb End -->

        <!-- Shop Section Begin -->
        <section class="shop spad">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3">
                        <div class="shop__sidebar">
                            <div class="sidebar__categories">
                                <div class="section-title">
                                    <h4>Categories</h4>
                                </div>
                                <div class="categories__accordion">
                                    <div class="accordion" id="accordionExample">
                                        <% categories.forEach(category => { %>
                                            <div class="card">
                                                <div class="card-heading">
                                                    <a  data-target="#<%= category._id %>"><%= category.name %></a>
                                                </div>
                                                <div id="<%= category._id %>" class="collapse" data-parent="#accordionExample">
                                                    <div class="card-body">
                                                        <ul>
                                                            <% if (category.subcategories && category.subcategories.length) { %>
                                                                <% category.subcategories.forEach(subcategory => { %>
                                                                    <li><a href="#"><%= subcategory.name %></a></li>
                                                                <% }); %>
                                                            <% } else { %>
                                                                <li>No subcategories available</li>
                                                            <% } %>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- <div class="sidebar__filter">
                                <div class="section-title">
                                    <h4>Shop by price</h4>
                                </div>
                                <div class="filter-range-wrap">
                                    <div class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"
                                    data-min="33" data-max="99"></div>
                                    <div class="range-slider">
                                        <div class="price-input">
                                            <p>Price:</p>
                                            <input type="text" id="minamount">
                                            <input type="text" id="maxamount">
                                        </div>
                                    </div>
                                </div>
                                <a href="#">Filter</a>
                            </div> -->
                            <div class="sidebar__sizes">
                                <div class="section-title">
                                    <h4>Shop by size</h4>
                                </div>
                                <div class="size__list">
                                    <label for="sizeS">
                                        s
                                        <input type="checkbox" id="sizeS">
                                        <span class="checkmark"></span>
                                    </label>
                                    <label for="sizeM">
                                        m
                                        <input type="checkbox" id="sizeM">
                                        <span class="checkmark"></span>
                                    </label>
                                    <label for="sizeL">
                                        l
                                        <input type="checkbox" id="sizeL">
                                        <span class="checkmark"></span>
                                    </label>
                                    
                                
                                </div>
                            </div>
                            <div class="sidebar__sizes">
                                <div class="section-title">
                                    <h4>Shop by </h4>
                                </div>
                                <div class="size__list">
                                    <label for="nameAZ">
                                        name (a-z)
                                        <input type="checkbox" id="nameAZ">
                                        <span class="checkmark"></span>
                                    </label>
                                    <label for="nameZA">
                                        name (z-a)
                                        <input type="checkbox" id="nameZA">
                                        <span class="checkmark"></span>
                                    </label>
                                    <label for="newArrivals">
                                        new arrivals
                                        <input type="checkbox" id="newArrivals">
                                        <span class="checkmark"></span>
                                    </label>
                                
                                    <label for="priceLowToHigh">
                                        price : low to high
                                        <input type="checkbox" id="priceLowToHigh">
                                        <span class="checkmark"></span>
                                    </label>
                                    <label for="priceHighToLow">
                                        price : high to low 
                                        <input type="checkbox" id="priceHighToLow">
                                        <span class="checkmark"></span>
                                    </label>
                                
                                </div>
                            </div>
                        
                        </div>
                    </div>
                    
                    <div class="col-lg-9 col-md-9">
                        <div class="row" id="productList">
                            <% productData.forEach(product => { %>
                                <div class="col-lg-4 col-md-6">
                                    <div class="product__item">
                                        <div class="product__item__pic" style="display: flex; justify-content: center; align-items: center;">
                                            <a href="/productDetails/<%= product._id %>">
                                                <img src="/uploads/products/<%= product.mainImage %>" alt="<%= product.name %>" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                                            </a>
                                            <% if (product.quantity == 0) { %>
                                                <div class="label out-of-stock" style="background-color: black; color: white;width: 110px; height: 20px;">Out of Stock</div>
                                            <% } else if (product.isNew) { %>
                                                <div class="label new" style="background-color: #36a300;width: 50px; height: 20px;">New</div>
                                            <% } %>
                                            <ul class="product__hover">
                                                <li><a href="/uploads/products/<%= product.mainImage[0] %>" class="image-popup"><span class="arrow_expand"></span></a></li>
                                                <li><a href="/wishlist"><span class="icon_heart_alt"></span></a></li>
                                                <% if (product.quantity > 0) { %>
                                                    <li><a href="/addToCart?productId=<%= product._id %>"><span class="icon_bag_alt"></span></a></li>
                                                <% } else { %>
                                                
                                                    <li><span class="icon_bag_alt_disabled"></span></li>
                                                <% } %>
                                            </ul>
                                            
                                        </div>
                                        <div class="product__item__text">
                                            <h6><a href="/productDetails/<%= product._id %>"><%= product.name %></a></h6>
                                            <div class="rating">
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                            </div>
                                            <div class="product__price">₹ <%= product.price %></div>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
                        <div class="col-lg-12 text-center">
                            <div class="pagination__option">
                                <a href="#">1</a>
                                <a href="#">2</a>
                                <a href="#">3</a>
                                <a href="#"><i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Shop Section End -->

    <%-include('../layouts/footer')  %>
    <script>
        // Add event listener for sorting checkboxes
    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('.sidebar__sizes input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                // Log the checkbox ID to ensure the event listener is triggered
                console.log('Checkbox ID:', checkbox.id);

                const criteria = checkbox.id;
                fetch(`/sort/${criteria}`, { method: 'GET' })
                    .then(response => response.json())
                    .then(data => {
                        // Log the fetched data to ensure it is received correctly
                        console.log('Fetched Data:', data);
                        updateProductList(data.productData);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
        });
    });

    function updateProductList(productData) {
        const productList = document.getElementById('productList');
        productList.innerHTML = '';

        productData.forEach(product => {
            const outOfStockLabel = product.quantity === 0 ? '<div class="label out-of-stock" style="background-color: black; color: white;width: 110px; height: 20px;">Out of Stock</div>' : '';
            const newLabel = product.isNew ? '<div class="label new" style="background-color: #36a300;width: 50px; height: 20px;">New</div>' : '';

            const productItem = `
                <div class="col-lg-4 col-md-6">
                    <div class="product__item">
                        <div class="product__item__pic" style="display: flex; justify-content: center; align-items: center;">
                            <a href="/productDetails/${product._id}">
                                <img src="/uploads/products/${product.mainImage}" alt="${product.name}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                            </a>
                            ${outOfStockLabel}
                            ${newLabel}
                            <ul class="product__hover">
                                <li><a href="/uploads/products/${product.mainImage}" class="image-popup"><span class="arrow_expand"></span></a></li>
                                <li><a href="/wishlist"><span class="icon_heart_alt"></span></a></li>
                                ${product.quantity > 0 ? `<li><a href="/addToCart?productId=${product._id}"><span class="icon_bag_alt"></span></a></li>` : '<li><span class="icon_bag_alt_disabled"></span></li>'}
                            </ul>
                        </div>
                        <div class="product__item__text">
                            <h6><a href="/productDetails/${product._id}">${product.name}</a></h6>
                            <div class="rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                            </div>
                            <div class="product__price">₹ ${product.price}</div>
                        </div>
                    </div>
                </div>
            `;
            productList.insertAdjacentHTML('beforeend', productItem);
        });
    }


    </script>
