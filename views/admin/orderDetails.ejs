<%- include('../layouts/adminheader') %>
<div class="container" style="margin-left: 120px;">
  <div class="row" style="margin-left: 120px">
    <div class="col-md-8">
      <!-- Order details -->
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Order Details</h4>
        </div>
        <div class="card-body">
          <p><strong>Order ID:</strong> <%= order._id %></p>
          <p><strong>Customer Name:</strong> <%= order.userId.name %></p>
          <p><strong>Order Status:</strong>
            <span class="badge status-label <%= product.status.toLowerCase() %>"><%= product.status %></span>
          </p>

          <!-- Delivery Address -->
          <h5>Delivery Address</h5>
          <!-- <p><strong>Address Type:</strong> <%= order.deliveryAddress.addresstype %></p> -->
          <p><strong>Address:</strong> <%= order.deliveryAddress.address %>, <%= order.deliveryAddress.locality %>, <%= order.deliveryAddress.city %>, <%= order.deliveryAddress.state %>, <%= order.deliveryAddress.pincode %></p>
    
          

          <!-- Ordered Item -->
          <h5>Product Details</h5>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Product Image</th>
                <th>Product Name</th>
                <th>Quantity</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div style="width: 50px; height: 70px; overflow: hidden; border: 1px solid #ccc; border-radius: 5px;">
                    <img src="<%= process.env.BASE_URL %>/uploads/products/<%= product.productId.mainImage %>" alt="<%= product.productId.name %> image" style="width: 100%; height: 100%; object-fit: cover;">
                  </div>
                </td>
                <td><%= product.productId.name %></td>
                <td><%= product.quantity %></td>
                <td><%= product.priceAtPurchase %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <!-- Change Product Status -->
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Change Product Status</h4>
        </div>
        <div class="card-body">
          <form id="updateProductStatusForm" action="/admin/updateProductStatus" method="POST">
            <div class="form-group">
              <input type="hidden" name="orderId" value="<%= order._id %>">
              <input type="hidden" name="productId" value="<%= product.productId._id %>">
              <label for="productStatus">Select Status:</label>
              <select class="form-control" id="productStatus" name="productStatus">
                <option value="pending" <%= product.status === 'pending' ? 'selected' : '' %>>Pending</option>
                <option value="confirmed" <%= product.status === 'confirmed' ? 'selected' : '' %>>Confirmed</option>
                <option value="shipped" <%= product.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
                <option value="delivered" <%= product.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
                <option value="cancelled" <%= product.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                
              </select>
            </div>
            <br>
            <button type="submit" class="btn btn-primary">Update Status</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include('../layouts/adminfooter') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<style>
  /* Define colors for each status */
  .status-label.pending {
    background-color: #ffc107; /* Yellow */
  }
  .status-label.confirmed {
    background-color: #0d6efd; /* Blue */
  }
  .status-label.shipped {
    background-color: #198754; /* Green */
  }
  .status-label.delivered {
    background-color: #198754; /* Green */
  }
  .status-label.cancelled {
    background-color: #dc3545; /* Red */
  }

  .status-label.returned {
    background-color: #dc3545; /* Red */
  }
</style>

<script>
  document.getElementById('updateProductStatusForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission

    const orderId = document.querySelector('input[name="orderId"]').value;
    const productId = document.querySelector('input[name="productId"]').value;
    const productStatus = document.getElementById('productStatus').value;

    fetch('/admin/updateProductStatus', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ orderId, productId, productStatus })
    })
    .then(response => {
      if (response.ok) {
        window.location.reload(); // Reload page on success
      } else {
        throw new Error('Failed to update product status');
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
</script>
